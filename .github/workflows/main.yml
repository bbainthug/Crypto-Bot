name: Daily Crypto Analysis

# è®¾å®šè§¦å‘æ¡ä»¶
on:
  schedule:
    # æ¯å¤© UTC 00:00 è¿è¡Œ (ç›¸å½“äºåŒ—äº¬æ—¶é—´æ—©ä¸Š 8:00)
    - cron: '0 0 * * *'
  # å…è®¸ä½ æ‰‹åŠ¨ç‚¹æŒ‰é’®è¿è¡Œ (æ–¹ä¾¿æµ‹è¯•)
  workflow_dispatch:

# è®¾ç½®æƒé™ (ä¸ºäº†èƒ½æŠŠ CSV å’Œå›¾ç‰‡å­˜å›ä»“åº“)
permissions:
  contents: write

jobs:
  run-bot:
    runs-on: ubuntu-latest
    
    steps:
      # 1. ä¸‹è½½ä½ çš„ä»£ç åˆ°è™šæ‹Ÿç”µè„‘
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. å®‰è£… Python ç¯å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. å®‰è£…ä¾èµ–åº“ (æ ¹æ®ä½ çš„æ¸…å•)
      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      # 4. è¿è¡Œä½ çš„æœºå™¨äºº
      - name: Run Analysis Script
        env:
          # æŠŠåˆšæ‰è®¾ç½®çš„ Secret æ³¨å…¥ç»™ä»£ç 
          CRYPTO_PANIC_KEY: ${{ secrets.CRYPTO_PANIC_KEY }}
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
        run: |
          # æ³¨æ„ï¼šè¿™é‡Œçš„æ–‡ä»¶åè¦æ”¹æˆä½ ä¸Šä¼ çš„é‚£ä¸ª Python æ–‡ä»¶åï¼
          python Advanced_Bot.py

      # 5. æŠŠç”Ÿæˆçš„æ–‡ä»¶ (CSV, JSON, PNG) å­˜å›ä»“åº“
      - name: Commit and Push results
        run: |
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "actions@github.com"
          
          # å°è¯•æ·»åŠ ç”Ÿæˆçš„æ–‡ä»¶
          git add *.csv *.json *.png
          
          # æäº¤ (å¦‚æœæ²¡æœ‰æ–°æ–‡ä»¶ç”Ÿæˆï¼Œè¿™æ­¥ä¸æŠ¥é”™)
          git commit -m "ğŸ“ˆ Auto-update: Daily Analysis Data" || echo "No changes to commit"
          
          # æ¨é€
          git push
